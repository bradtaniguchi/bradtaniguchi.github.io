<!DOCTYPE html><html style="visibility:hidden"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>bradtaniguchi.dev</title><meta name="next-head-count" content="3"/><style data-styled="" data-styled-version="5.3.6">.euSTV{border-color:#d0d7de;border-width:1px;border-style:solid;border-radius:8px;}/*!sc*/
.fbFwzG{padding:16px;background-color:#f6f8fa;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;border-radius:8px 8px 0 0;}/*!sc*/
.cHEEYb{padding:16px;}/*!sc*/
data-styled.g3[id="Box-sc-1gh2r6s-0"]{content:"euSTV,fbFwzG,cHEEYb,"}/*!sc*/
</style><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-78MY48NN11"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-78MY48NN11', {
              page_path: window.location.pathname,
            });
          </script><meta data-react-helmet="true" name="description" content="Brad Taniguchi&#x27;s portfolio/blog/website"/><meta data-react-helmet="true" property="og:description" content="Brad Taniguchi&#x27;s portfolio/blog/website"/><meta data-react-helmet="true" property="og:title" content="bradtaniguchi.dev"/><meta data-react-helmet="true" property="og:url" content="https://bradtaniguchi.dev"/><meta data-react-helmet="true" property="og:site_name" content="npm"/><meta data-react-helmet="true" name="keywords" content="git,react,github,bradtaniguchi"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:url" content="https://bradtaniguchi.dev"/><meta data-react-helmet="true" name="twitter:title" content="https://bradtaniguchi.dev"/><meta data-react-helmet="true" name="twitter:description" content="Brad Taniguchi&#x27;s portfolio/blog/website"/><link rel="preload" href="/_next/static/css/6ee964af21479aba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6ee964af21479aba.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-f9529ea581ae7296.js" defer=""></script><script src="/_next/static/chunks/framework-8080449f0215cedd.js" defer=""></script><script src="/_next/static/chunks/main-558df491adac0f7f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b6d8e4c11574db13.js" defer=""></script><script src="/_next/static/chunks/4c744e84-96c16c6ce6f2cf13.js" defer=""></script><script src="/_next/static/chunks/97-672258ad777dcce2.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-533f6ae205f667bc.js" defer=""></script><script src="/_next/static/ABywyslJDuRTbQyYhe_VL/_buildManifest.js" defer=""></script><script src="/_next/static/ABywyslJDuRTbQyYhe_VL/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div color="fg.default" font-family="normal" data-portal-root="true" class="BaseStyles__Base-sc-nfjs56-0 gRfwpC"><header class="Header-sc-11fu6rh-0 bBVtyJ"><div class="Header__HeaderItem-sc-11fu6rh-1 jTwoLh"><a href="/" class="Header__HeaderLink-sc-11fu6rh-2 hIZhUi"><svg aria-hidden="true" role="img" class="StyledOcticon-sc-1lhyyr-0 Wxhfz" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible"><path fill-rule="evenodd" d="M10.5 5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zm.061 3.073a4 4 0 10-5.123 0 6.004 6.004 0 00-3.431 5.142.75.75 0 001.498.07 4.5 4.5 0 018.99 0 .75.75 0 101.498-.07 6.005 6.005 0 00-3.432-5.142z"></path></svg><h1 font-size="inherit" class="Text-sc-125xb1i-0 fdzcGy">bradtaniguchi.dev</h1></a></div><div class="Header__HeaderItem-sc-11fu6rh-1 bqrDZM"></div><nav class="Box-sc-1gh2r6s-0"><div display="none,inline-block" class="Box-sc-1gh2r6s-0 hlLimd"><div class="Header__HeaderItem-sc-11fu6rh-1 jTwoLh"><a href="/" class="Header__HeaderLink-sc-11fu6rh-2 hIZhUi"><svg aria-hidden="true" role="img" class="StyledOcticon-sc-1lhyyr-0 Wxhfz" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible"><path fill-rule="evenodd" d="M8.156 1.835a.25.25 0 00-.312 0l-5.25 4.2a.25.25 0 00-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 01.75-.75h3.5a.75.75 0 01.75.75v5.25h2.75a.25.25 0 00.25-.25V6.23a.25.25 0 00-.094-.195l-5.25-4.2zM6.906.664a1.75 1.75 0 012.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0113.25 15h-3.5a.75.75 0 01-.75-.75V9H7v5.25a.75.75 0 01-.75.75h-3.5A1.75 1.75 0 011 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2h-.001z"></path></svg><span>Home</span></a></div></div><div display="none,inline-block" class="Box-sc-1gh2r6s-0 hlLimd"><div class="Header__HeaderItem-sc-11fu6rh-1 jTwoLh"><a href="/projects" class="Header__HeaderLink-sc-11fu6rh-2 hIZhUi"><svg aria-hidden="true" role="img" class="StyledOcticon-sc-1lhyyr-0 Wxhfz" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible"><path fill-rule="evenodd" d="M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z"></path></svg><span>Projects</span></a></div></div><div display="none,inline-block" class="Box-sc-1gh2r6s-0 hlLimd"><div class="Header__HeaderItem-sc-11fu6rh-1 jTwoLh"><a href="/blog" class="Header__HeaderLink-sc-11fu6rh-2 hIZhUi"><svg aria-hidden="true" role="img" class="StyledOcticon-sc-1lhyyr-0 Wxhfz" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible"><path fill-rule="evenodd" d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z"></path></svg><span>Blog</span></a></div></div><div display="none,inline-block" class="Box-sc-1gh2r6s-0 hlLimd"><div class="Header__HeaderItem-sc-11fu6rh-1 jTwoLh"><a href="/about" class="Header__HeaderLink-sc-11fu6rh-2 hIZhUi"><svg aria-hidden="true" role="img" class="StyledOcticon-sc-1lhyyr-0 Wxhfz" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm9 3a1 1 0 11-2 0 1 1 0 012 0zM6.92 6.085c.081-.16.19-.299.34-.398.145-.097.371-.187.74-.187.28 0 .553.087.738.225A.613.613 0 019 6.25c0 .177-.04.264-.077.318a.956.956 0 01-.277.245c-.076.051-.158.1-.258.161l-.007.004a7.728 7.728 0 00-.313.195 2.416 2.416 0 00-.692.661.75.75 0 001.248.832.956.956 0 01.276-.245 6.3 6.3 0 01.26-.16l.006-.004c.093-.057.204-.123.313-.195.222-.149.487-.355.692-.662.214-.32.329-.702.329-1.15 0-.76-.36-1.348-.863-1.725A2.76 2.76 0 008 4c-.631 0-1.155.16-1.572.438-.413.276-.68.638-.849.977a.75.75 0 101.342.67z"></path></svg><span>About</span></a></div></div></nav><div class="Box-sc-1gh2r6s-0 dQWaez"><button id="theme-toggle-button" title="Switch to night mode" aria-label="Switch to night mode" class="types__StyledButton-sc-ws60qy-0 hdRiGs"><span class="Box-sc-1gh2r6s-0 kqWLFK"><svg aria-hidden="true" role="img" class="octicon octicon-moon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible"><path fill-rule="evenodd" d="M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z"></path></svg></span></button></div><div display="block,none" class="Box-sc-1gh2r6s-0 dbtHVB"><div class="Header__HeaderItem-sc-11fu6rh-1 jTwoLh"><button id="menu-button" aria-label="Menu Button" aria-haspopup="true" aria-expanded="false" class="types__StyledButton-sc-ws60qy-0 hdRiGs"><span class="Box-sc-1gh2r6s-0 kqWLFK"><svg aria-hidden="true" role="img" class="octicon octicon-three-bars" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible"><path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z"></path></svg></span></button></div></div></header><main><div class="Box-sc-1gh2r6s-0 ceYjBN"><div class="Box-sc-1gh2r6s-0 euSTV"><div display="flex" class="Box-sc-1gh2r6s-0 fbFwzG"><span>UTF-8 vs UTF-16</span><span><a aria-label="Back to Blog List" href="/blog"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path></svg></a></span></div><div class="Box-sc-1gh2r6s-0 cHEEYb"><div><h1 id="utf-8-vs-utf-16">UTF-8 vs UTF-16</h1>
<p>I don't remember the last time a bug like this has ruined my day, but this issue was a great reminder about "hidden characters", text encoding and the disadvantages of copy-pasting.</p>
<h2 id="the-background">The background</h2>
<p>As part of learning how to build a github-page with all the bells and whistles, I wanted to add lighthouse testing to the mix. Specifically adding this <a href="https://github.com/treosh/lighthouse-ci-action">github action</a>:</p>
<pre><code>treosh/lighthouse-ci-action@v7
</code></pre>
<p>This github-action should of been as easy as adding it to the existing workflow file I have, and optionally adding 2 extra files, a budget file, and an rc file.
All examples revolved around these 2 files and its configuration within the workflow file. At a glance I <del>wrongly</del> assumed this would take under 10 minutes of work to get some basic lighthouse testing up and running.</p>
<p>The process ended up taking multiple hours, included a walk to help clear my brain, multiple profanities, a whole lot of second guessing and a resolution that ultimately didn't feel like a "win" but was one nonetheless.</p>
<h2 id="the-problem">The problem</h2>
<p>The problem started with me trying to be clever and use the <a href="https://github.com/GoogleChrome/lighthouse-ci/blob/main/docs/configuration.md">yaml configuration for lighthouse</a>, rather than the traditional json format. Because of this, I used a starting JSON file example, and then an online converter to convert the JSON to YAML as <strong>I was lazy at the time</strong>.</p>
<p>The end result was the following text (this was copied directly from the <a href="https://github.com/bradtaniguchi/bradtaniguchi.github.io/blob/2ab3efef433969f2caaf9b09f91b8cc7294164b8/lighthouserc.yaml">source</a>):</p>
<pre><code class="language-yaml">ci:
  url:
    - http://localhost/
  collect:
    staticDistDir: './public/static'
</code></pre>
<p><strong>note</strong> this first version is actually incorrect compared to the final format, which correctly used the <code>staticDistDir</code> of <code>public/client-static</code>, but this would of given me a different more friendly error than what occurred.</p>
<p>From this YAML file, I deployed my to my CI/CD and where I was introduced to this friendly error message:</p>
<pre><code>Run treosh/lighthouse-ci-action@v2
Action config
  Error: end of the stream or a document separator is expected at line 1, column 4:
      ��c
         ^
</code></pre>
<p><strong>note</strong> this was copied directly from the <a href="https://github.com/bradtaniguchi/bradtaniguchi.github.io/runs/3003815331?check_suite_focus=true">source</a></p>
<p>By this point I introduced only 2 new files, and made changes to my CI/CD workflow file. The issue had to be isolated to one of the 2 files, <strong>or</strong> the 2 files are working correctly and what is being loaded/tested by lighthouse is failing.</p>
<p><strong>this is where I started to debug.... a lot, and where the trials began....</strong></p>
<h2 id="the-trials">The trials</h2>
<p>I started debugging with the 2 files I added, the rc file and the budget file. Both looked like valid contents, except with every deployment I kept getting <strong>the same error</strong>. It took roughly 5-6 builds to get a different error, which was when I 100% removed all changes except the changes to the github-action workflow itself. At this point I took a walk to help clear my head from all the red <code>x</code>s.</p>
<p>Knowing that the issue was isolated to the single file, I started getting a nagging feeling the lighthouserc.json file had an issue with it, maybe one I couldn't actually see. It was at this point I directly ran the lighthouse action in nodejs and got the same issue, except without having to wait for the CI/CD pipeline. It was then I realized.... VSCode pointed out the file format was in <code>UTF-16</code> rather than the usual <code>UTF-8</code>. I switched the file format, and lo and behold, the CI/CD failed a different way. I walked away and accepted that I essentially "fixed" the problem.</p>
<h2 id="the-solution">The solution</h2>
<p>The issue was there was 2 invisible character introduced at the start of the time by the yaml-to-json converter. This apparently created the error message I saw in the lighthouse-ci action during serialization of the JSON file. I don't remember exactly what was the character(s), but will remember to check that small box in the corner showing the text encoding, as this sort of problem wasted too much of my time already, and I don't plan on letting it waste more in the future.</p>
</div></div></div></div></main></div><script type="application/json" id="__PRIMER_DATA__">{"resolvedServerColorMode":"day"}</script></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"blogPost":{"title":"UTF-8 vs UTF-16","description":"A lesson in copy-paste","published":true,"date":"2021-07-07T00:00:00.000Z","slug":"utf-8-vs-utf-16","tags":["github-action","github"]},"markdown":"\u003ch1 id=\"utf-8-vs-utf-16\"\u003eUTF-8 vs UTF-16\u003c/h1\u003e\n\u003cp\u003eI don't remember the last time a bug like this has ruined my day, but this issue was a great reminder about \"hidden characters\", text encoding and the disadvantages of copy-pasting.\u003c/p\u003e\n\u003ch2 id=\"the-background\"\u003eThe background\u003c/h2\u003e\n\u003cp\u003eAs part of learning how to build a github-page with all the bells and whistles, I wanted to add lighthouse testing to the mix. Specifically adding this \u003ca href=\"https://github.com/treosh/lighthouse-ci-action\"\u003egithub action\u003c/a\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003etreosh/lighthouse-ci-action@v7\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis github-action should of been as easy as adding it to the existing workflow file I have, and optionally adding 2 extra files, a budget file, and an rc file.\nAll examples revolved around these 2 files and its configuration within the workflow file. At a glance I \u003cdel\u003ewrongly\u003c/del\u003e assumed this would take under 10 minutes of work to get some basic lighthouse testing up and running.\u003c/p\u003e\n\u003cp\u003eThe process ended up taking multiple hours, included a walk to help clear my brain, multiple profanities, a whole lot of second guessing and a resolution that ultimately didn't feel like a \"win\" but was one nonetheless.\u003c/p\u003e\n\u003ch2 id=\"the-problem\"\u003eThe problem\u003c/h2\u003e\n\u003cp\u003eThe problem started with me trying to be clever and use the \u003ca href=\"https://github.com/GoogleChrome/lighthouse-ci/blob/main/docs/configuration.md\"\u003eyaml configuration for lighthouse\u003c/a\u003e, rather than the traditional json format. Because of this, I used a starting JSON file example, and then an online converter to convert the JSON to YAML as \u003cstrong\u003eI was lazy at the time\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eThe end result was the following text (this was copied directly from the \u003ca href=\"https://github.com/bradtaniguchi/bradtaniguchi.github.io/blob/2ab3efef433969f2caaf9b09f91b8cc7294164b8/lighthouserc.yaml\"\u003esource\u003c/a\u003e):\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eci:\n  url:\n    - http://localhost/\n  collect:\n    staticDistDir: './public/static'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003enote\u003c/strong\u003e this first version is actually incorrect compared to the final format, which correctly used the \u003ccode\u003estaticDistDir\u003c/code\u003e of \u003ccode\u003epublic/client-static\u003c/code\u003e, but this would of given me a different more friendly error than what occurred.\u003c/p\u003e\n\u003cp\u003eFrom this YAML file, I deployed my to my CI/CD and where I was introduced to this friendly error message:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eRun treosh/lighthouse-ci-action@v2\nAction config\n  Error: end of the stream or a document separator is expected at line 1, column 4:\n      ��c\n         ^\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003enote\u003c/strong\u003e this was copied directly from the \u003ca href=\"https://github.com/bradtaniguchi/bradtaniguchi.github.io/runs/3003815331?check_suite_focus=true\"\u003esource\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eBy this point I introduced only 2 new files, and made changes to my CI/CD workflow file. The issue had to be isolated to one of the 2 files, \u003cstrong\u003eor\u003c/strong\u003e the 2 files are working correctly and what is being loaded/tested by lighthouse is failing.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ethis is where I started to debug.... a lot, and where the trials began....\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 id=\"the-trials\"\u003eThe trials\u003c/h2\u003e\n\u003cp\u003eI started debugging with the 2 files I added, the rc file and the budget file. Both looked like valid contents, except with every deployment I kept getting \u003cstrong\u003ethe same error\u003c/strong\u003e. It took roughly 5-6 builds to get a different error, which was when I 100% removed all changes except the changes to the github-action workflow itself. At this point I took a walk to help clear my head from all the red \u003ccode\u003ex\u003c/code\u003es.\u003c/p\u003e\n\u003cp\u003eKnowing that the issue was isolated to the single file, I started getting a nagging feeling the lighthouserc.json file had an issue with it, maybe one I couldn't actually see. It was at this point I directly ran the lighthouse action in nodejs and got the same issue, except without having to wait for the CI/CD pipeline. It was then I realized.... VSCode pointed out the file format was in \u003ccode\u003eUTF-16\u003c/code\u003e rather than the usual \u003ccode\u003eUTF-8\u003c/code\u003e. I switched the file format, and lo and behold, the CI/CD failed a different way. I walked away and accepted that I essentially \"fixed\" the problem.\u003c/p\u003e\n\u003ch2 id=\"the-solution\"\u003eThe solution\u003c/h2\u003e\n\u003cp\u003eThe issue was there was 2 invisible character introduced at the start of the time by the yaml-to-json converter. This apparently created the error message I saw in the lighthouse-ci action during serialization of the JSON file. I don't remember exactly what was the character(s), but will remember to check that small box in the corner showing the text encoding, as this sort of problem wasted too much of my time already, and I don't plan on letting it waste more in the future.\u003c/p\u003e\n"},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"utf-8-vs-utf-16"},"buildId":"ABywyslJDuRTbQyYhe_VL","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>